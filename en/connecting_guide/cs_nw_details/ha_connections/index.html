<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="description" content="A light introduction regarding how MongoDB drivers will automatically respond to server failures">
<meta name="author" content="Akira Kurogane">

    <link rel="icon" href="/mongodb-guide/images/favicon.png" type="image/png">

    <title>Automatic failover :: Akira&#39;s MongoDB Guide</title>

    
    <link href="/mongodb-guide/css/nucleus.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/fontawesome-all.min.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/hybrid.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/featherlight.min.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/perfect-scrollbar.min.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/auto-complete.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/atom-one-dark-reasonable.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/theme.css?1559169793" rel="stylesheet">
    <link href="/mongodb-guide/css/hugo-theme.css?1559169793" rel="stylesheet">
    
      <link href="/mongodb-guide/css/theme-green.css?1559169793" rel="stylesheet">
    

    <script src="/mongodb-guide/js/jquery-3.3.1.min.js?1559169793"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/mongodb-guide/en/connecting_guide/cs_nw_details/ha_connections/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

Akira's MongoDB Guide

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/mongodb-guide/js/lunr.min.js?1559169793"></script>
<script type="text/javascript" src="/mongodb-guide/js/auto-complete.js?1559169793"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/akira-kurogane.github.io\/mongodb-guide\/\/en";
    
</script>
<script type="text/javascript" src="/mongodb-guide/js/search.js?1559169793"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/mongodb-guide/en/guide_intro/" title="What you can do with MongoDB" class="dd-item 
        
        
        
        ">
      <a href="/mongodb-guide/en/guide_intro/">
          <b>1. </b>What you can do with MongoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/mongodb-guide/en/connecting_guide/" title="Connecting to MongoDB" class="dd-item 
        parent
        
        
        ">
      <a href="/mongodb-guide/en/connecting_guide/">
          <b>2. </b>Connecting to MongoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/mongodb-guide/en/connecting_guide/human_ix/" title="How to connect from your app or a terminal" class="dd-item 
        
        
        
        ">
      <a href="/mongodb-guide/en/connecting_guide/human_ix/">
          Human how-to
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/mongodb-guide/en/connecting_guide/human_ix/conn_string_uri/" title="Connection string URI" class="dd-item 
        
        
        
        ">
      <a href="/mongodb-guide/en/connecting_guide/human_ix/conn_string_uri/">
          Connection string URI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/mongodb-guide/en/connecting_guide/human_ix/mongo_shell/" title="The mongo shell" class="dd-item 
        
        
        
        ">
      <a href="/mongodb-guide/en/connecting_guide/human_ix/mongo_shell/">
          The mongo shell
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/mongodb-guide/en/connecting_guide/cs_nw_details/" title="Client-Server network communication" class="dd-item 
        parent
        
        
        ">
      <a href="/mongodb-guide/en/connecting_guide/cs_nw_details/">
          client ⇄ TCP ⇄ db server
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/mongodb-guide/en/connecting_guide/cs_nw_details/drivers/" title="Drivers and &#39;the wire&#39;" class="dd-item 
        
        
        
        ">
      <a href="/mongodb-guide/en/connecting_guide/cs_nw_details/drivers/">
          Drivers and &#39;the wire&#39;
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/mongodb-guide/en/connecting_guide/cs_nw_details/ha_connections/" title="Automatic failover" class="dd-item 
        parent
        active
        
        ">
      <a href="/mongodb-guide/en/connecting_guide/cs_nw_details/ha_connections/">
          Automatic failover
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/akira-kurogane/mongodb-guide"><i class='fa fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://akira-kurogane.github.io/en/mongodb-guide/credits"><i class='fa fa-fw fa-bullhorn'></i> Theme credits</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://akira-kurogane.github.io/mongodb-guide/en/connecting_guide/cs_nw_details/ha_connections/" selected>English</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <center>

    Github repo: 
    
    <a class="github-button" href="https://github.com/akira-kurogane/mongodb-guide" data-icon="octicon-star" data-show-count="false" aria-label="Star Akira's MongoDB Guide on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/akira-kurogane/mongodb-guide/fork" data-icon="octicon-repo-forked" data-show-count="false" aria-label="Fork Akira's MongoDB Guide on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/mongodb-guide/en/'>Top page</a> > <a href='/mongodb-guide/en/connecting_guide/'>Connecting to MongoDB</a> > <a href='/mongodb-guide/en/connecting_guide/cs_nw_details/'>Client-Server network communication</a> > Automatic failover
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Automatic failover
            </h1>
          

        




	<p>Although it hasn't been discussed in the book in detail so far, in the typical situation your client will be connected to a replica set, that is it will be sending writes to one node (the Primary) whilst also being connected to other nodes that are Secondaries. As long as the Primary is alive, accepting commands, and the other nodes continue to agree that it is the primary, that will continue without change.</p>

<p>But if the original primary node dies, or get cuts off network-wise from the other nodes, they will initiate a replica set election and one of them will become the new primary.</p>

<p>There be may some writes to the original primary that will have to be rolled back, particularly in an unbalanced network partition situation. That is an issue that means the rolled back operations will have to be examined manually and re-applied manually by administrators after the incident.</p>

<p>The election would take a fraction of a second usually (2 seconds at most), faster than any human is going to be able to react, so you want the application to automatically switch to use the new primary.</p>

<p>Q. What do you program to make sure the client application send requests to the new primary, and avoid having every single thread in every single process throw endless repeating 'socket exception' or 'write rejected not primary' errors?</p>

<p>A. Nothing. Because all the drivers have replica set automatic failover logic programmed into them you can't program (and don't need to program) anything extra to achieve re-routing to the surviving nodes.</p>

<p>From the point of view of the application code using a MongoDB connection, database, or collection object it can continue to use the same object. The driver will route the reads and writes to the new primary. If you have explicitly requested reads to come from a non-primary node (possible with a feature called readPreference, to be discussed later) the connection for those will be changed away from the new primary node too.</p>

<p>So the challenge of staying connected is solved for you out of the box whichever driver you use.</p>

<p>What is <em>not</em> handled is what to do with rolled back data. Rollbacks can occur in the case that the original primary doesn't step down immediately, and accepts some writes in the brief time before it determines it has lost the status updates from the other nodes and steps itself down. This will be explained more in the &quot;Making MongoDB stable&quot; chapter.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/mongodb-guide/en/connecting_guide/cs_nw_details/drivers/" title="Drivers and &#39;the wire&#39;"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/mongodb-guide/en/connecting_guide/cs_nw_details/drivers/" title="Drivers and &#39;the wire&#39;" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/mongodb-guide/js/clipboard.min.js?1559169793"></script>
    <script src="/mongodb-guide/js/perfect-scrollbar.min.js?1559169793"></script>
    <script src="/mongodb-guide/js/perfect-scrollbar.jquery.min.js?1559169793"></script>
    <script src="/mongodb-guide/js/jquery.sticky.js?1559169793"></script>
    <script src="/mongodb-guide/js/featherlight.min.js?1559169793"></script>
    <script src="/mongodb-guide/js/html5shiv-printshiv.min.js?1559169793"></script>
    <script src="/mongodb-guide/js/highlight.pack.js?1559169793"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/mongodb-guide/js/modernizr.custom-3.6.0.js?1559169793"></script>
    <script src="/mongodb-guide/js/learn.js?1559169793"></script>
    <script src="/mongodb-guide/js/hugo-learn.js?1559169793"></script>

    <link href="/mongodb-guide/mermaid/mermaid.css?1559169793" type="text/css" rel="stylesheet" />
    <script src="/mongodb-guide/mermaid/mermaid.js?1559169793"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-105947713-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
